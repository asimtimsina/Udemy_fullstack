391. Connecting Mongoose to Mongo

npm i moongose


393. Our First Mongoose Model

model is a representation of a collection in the database
must define the schema for the model
schema defines the structure of the document, default values, validators, etc.

const movieSchema = new mongoose.Schema({
    title: String,
    year: Number,
    score: Number,
    rating: String
});

take this schema and compile it into a model

const Movie = mongoose.model('Movie', movieSchema); 
// Movie is the name of the model 
// creates a collection called movies

Add a movie instance to the database

const amadeus = new Movie({title: 'Amadeus', year: 1986, score: 9.2, rating: 'R'});
amadeus.save(); // saves to the database


const Herapheri = new Movie({ title: 'Hera pheri', year: 2001, score: 9, rating: 'R' })
const Herapheri_2 = new Movie({ title: 'Hera pheri 2', year: 2010, score: 7, rating: 'R' })

Herapheri.save(); // save to the database


Herapheri_2.save() // save to the database

Herapheri_2.score = 2.5; // update the score
Herapheri_2.save(); // save the updated score


394. Insert Many

Movie.insertMany([
    {title: 'Amelie', year: 2001, score: 8.3, rating: 'R'},
    {title: 'Alien', year: 1979, score: 8.1, rating: 'R'},
    {title: 'The Iron Giant', year: 1999, score: 7.5, rating: 'PG'},
    {title: 'Stand By Me', year: 1986, score: 8.6, rating: 'R'},
    {title: 'Moonrise Kingdom', year: 2012, score: 7.3, rating: 'PG-13'}
])
.then(data => {
    console.log('It worked!');
    console.log(data);
})


395. Finding With Mongoose

Finding takes time so it returns a promise
can use .then() or async/await

.find()
.findOne()
.findById()


Movie.find(); -> returns the object
Movie.find().then(data => console.log(data)); -> returns all movies

Movie.find({year : {$gt:2010}}).then(data => console.log(data)); -> returns movies with year greater than 2010
Movie.findOne({year : {$gt:2010}}).then(data => console.log(data)); -> returns movies with year greater than 2010

Movie.findById('64a061c24239a7296e679a77').then(data => console.log(data));


396. Updating With Mongoose

.updateOne()
.updateMany()
.findOneAndUpdate()
.findByIdAndUpdate()

 Movie.updateOne({title:'Amelie'},{year:1984}).then(res => console.log(res))

 Movie.updateMany({ title: { $in: ['Amadeus', 'Stand by me'] } }, { score: 10 })
    .then(res => console.log(res))

Movie.findOneAndUpdate({title:'The Iron Giant'},{score:7.8}, {new:true}).then(res => console.log(res))
// new:true returns the updated object // new:false returns the old object (by default it is false)
